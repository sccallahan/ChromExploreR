ChromExploreR
================

**Based on the original ChromExploreR code by [Ayush T Raman](linkedin.com/in/aayushraman)**


Intro
-----

This is the way we run ChromExploreR (herafter 'ChromXR') in the lab. It allows the function to be run from within RStudio once the directories are properly organized.

This script requires the '12chromHMM' folder from our lab's ChIP pipeline (or, generally, the main output directory from ChromHMM). It also requires that you have not changed the names of the directories or changed the overall directory structure inside 12chromHMM. The libraries and source files needed to run the script are included in the `Files` directory. The 'Custom\_functions\_pub.R' file is a source file that has required custom functions. This script also REQUIRES a bash script called 'chromXRloop.sh' and the 3 files ChromXR normally requires (listed below).

Step 1: Organize files needed for perl script (4 files total):

-   chromStatesMatrixforClustering\_particularStates.pl in 12chromHMM/
-   hg19 genome size in 12chromHMM/
-   chromXRloop.sh in 12chroHMM/
-   a cellmark file (made by the user) listing samples --&gt; MUST be a .txt called 'namesChromXR' placed in MYOUTPUT/

Step 2: set arguments for `doChromXR`

-   os\_type = which operating system are you using? One of "mac" "linux" or "win10"
    -   default value is "mac"
-   chromhmm = point to the location of your 12chromHMM folder
-   dir = location of the chromStates output (CombinedMatrix \[...\])
    -   THIS IS WHERE YOUR PLOTS WILL BE SAVED, default value is MYOUTPUT/
-   statenum = number of states in model
-   samplenames = names of samples used for cellmarkfile, in the SAME ORDER as the cellmarkfile
    -   example: c("sample1", "sample2") --&gt; quotation marks NECESSARY
-   conditions = what makes your samples different? Enter values in the order they apply to your samples
    -   example: c(rep("Treated", 2), rep("Untreated", 2)) --&gt; first 2 samples Treated, second 2 are Untreated
-   hmapcol = list the colors you want/need for your heatmap group. Equal to number of conditions.
    -   example: c("red", "blue") would suffice for two groups colored red and blue
-   mdscol = list the colors for your MDS plot groups. Equal to number of conditions.
    -   default is the reverse of hmapcolors --&gt; pheatmap and ggplot have "opposite" colors, can also be manually changed

Step 3: Run entire script using cntrl+alt+R (windows/linux) or command+option+R (mac)

WHERE ARE YOUR FILES SAVED? The chromstate files are saved to 12chromHMM/MYOUTPUT. The plots are saved to the directory you set in the `doChromXR` "dir" argument. This location will be printed into the console upon completion of the script.

Code
----

``` r
##############################################################################
# Authors: S. Carson Callahan - ChromXR automation scripts and functions
#          Ayush T. Raman - ChromXR base perl script, analysis code
#          Christopher Terranova - Analysis code chunks
# 
# Program Use:
# 1. Run ChromXR in a single script
##############################################################################

## libraries
source("path/to/Custom_functions_pub.R")
library(tidyverse)
library(circlize)
library(pheatmap)
library(gplots)
library(genefilter)
library(reshape2)
library(vegan)

## Run ChromXR
doChromXR() # 8 arguments required (as described above), only 3 have a default value (os_type, dir, mdscol)
```

Summary
-------

Full code for the `doChromXR` function can be found in the `Custom_functions_pub.R` script in the `Files` directory.

The Intro section of this post describes what each argument of `doChromXR` is and what sorts of input each takes. The Code chunk above is how we normally run the `doChromXR` function, with the required libraries included. This function is compatible with any color you'd like to give your plots, ranging from hex values to color names from various palettes. Since the `doChromXR` function is just a simple custom function, you can easily open the code to tweak whichever parameters you feel necessary. We have included PCA plots by default, but the data generated by ChromXR tends to be nearly binary (i.e. there generally either is or is not a chromatin state at a given genomic locus, with very few n &gt; 1 regions), so we tend to prefer MDS plots and heatmaps.

Related Posts
-----

An example of outputs from ChromExploreR analysis can be found [here on Rpubs.](http://rpubs.com/cjt5/502911)
